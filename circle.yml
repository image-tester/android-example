machine:
  environment:
    ANDROID_HOME: "/usr/local/android-sdk-linux"

dependencies:
  override:
    # create an emulator avd
    - echo 'y' | android update sdk -u -a -t sys-img-x86-android-21 # is this the right thing?
    - echo 'no' | android create avd -n testing -t android-21 --abi "default/x86"
    # install actual dependencies
    - echo 'y' | android update sdk -u --all --filter "build-tools-21.1.2"
    - echo 'y' | android update sdk -u --all --filter "platform-tools-2.1.2"
    - echo 'y' | android update sdk -u --all --filter "extra-android-support"
    - echo 'y' | android update sdk -u --all --filter "extra-android-m2repository"
    - echo 'y' | android update sdk -u --all --filter "extra-google-m2repository"
    - ./gradlew dependencies

test:
  override:
    # start the emulator
    - $ANDROID_HOME/tools/emulator -avd testing -no-window -no-boot-anim -no-audio:
        background: true
        parallel: true
    - adb wait-for-device
    - sleep 5
    - ./gradlew connectedAndroidTest --full-stacktrace
    - cp -r app/build/outputs $CIRCLE_ARTIFACTS